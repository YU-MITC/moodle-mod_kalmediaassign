{"version":3,"file":"preview.min.js","sources":["../src/preview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Scripts for mod_kalmediaassign\n *\n * @copyright (C) 2016-2023 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_kalmediaassign/preview\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initial function.\n         * @access public\n         * @param {int} argWidth - width of modal content for preview.\n         * @param {int} argHeight - height of modal content for preview.\n         */\n        init: function(argWidth, argHeight) {\n\n            var modalX = 0;\n            var modalY = 0;\n            var modalWidth = argWidth;\n            var modalHeight = argHeight;\n\n            /**\n             * This function centerize modal window.\n             */\n            function centeringModalSyncer() {\n\n                // Get width and height of window.\n                var w = $(window).width();\n                var h = $(window).height();\n\n                var width = parseInt(modalWidth);\n                var height = parseInt(modalHeight);\n\n                $(\"#modal_content\").css({\"width\": (width + 40) + \"px\", \"height\": (height + 40) + \"px\"});\n\n                // Get width and height of content area.\n                var cw = $(\"#modal_content\").outerWidth();\n                var ch = $(\"#modal_content\").outerHeight();\n\n                // Execute centering.\n                $(\"#modal_content\").css({\"left\": ((w - cw) / 2) + \"px\", \"top\": ((h - ch) / 2) + \"px\"});\n            }\n\n            /**\n             * This function print modal window.\n             * @return {bool} - if modal window opend, return true. Otherwise, return false.\n             */\n            function fadeInModalWindow() {\n                // All contents in web page release focus.\n                $(this).blur();\n                // Precent dupulicate execute of modal window.\n                if ($(\"#modal_window\")[0]) {\n                    return false;\n                }\n\n                var width = parseInt(modalWidth);\n                var height = parseInt(modalHeight);\n\n                $(\"#modal_content\").css({\"width\": (width + 40) + \"px\", \"height\": (height + 40) + \"px\"});\n\n                // Record current scroll position.\n                var dElm = document.documentElement;\n                var dBody = document.body;\n                modalX = dElm.scrollLeft || dBody.scrollLeft; // Get x value of current position.\n                modalY = dElm.scrollTop || dBody.scrollTop; // Get y valueion of current position.\n                // Create modal window and a content area.\n                $(\"body\").append(\"<div id=\\\"modal_content\\\"></div>\");\n                $(\"body\").append(\"<div id=\\\"modal_window\\\"></div>\");\n                $(\"#modal_window\").fadeIn(\"normal\");\n\n                // Centering content area.\n                centeringModalSyncer();\n                // Fade-in content area.\n                $(\"#modal_content\").fadeIn(\"normal\");\n\n                return true;\n            }\n\n            /**\n             * This function delete content area and modal window.\n             */\n            function fadeOutModalWindow() {\n                // Rescore scroll position to web brawser.\n                window.scrollTo(modalX, modalY);\n\n                // Fade-put content area and modal window.\n                $(\"#modal_content,#modal_window\").fadeOut(\"normal\", function() {\n                    $(\"#modal_window\").remove();\n                    $(\"#modal_content\").remove();\n                });\n            }\n\n            /**\n             * This function create preview panel\n             */\n            function createPreviewPanel() {\n                // View modal window.\n                fadeInModalWindow();\n\n                var element = $(\"#hidden_markup\");\n                var str = '';\n                str += \"<center>\";\n\n                if (element !== null) {\n                    str += element.html();\n                } else {\n                    str += \"Sorry! Media not found.\";\n                }\n\n                str += \"</center>\";\n                str += \"<center>\";\n                str += \"<input type=\\\"button\\\" id=\\\"cancel_btn\\\" value=\\\"Close\\\">\";\n                str += \"</center>\";\n\n                $(\"#modal_content\").append(str);\n\n                $(\"#cancel_btn\").on(\"click\", function() {\n                    fadeOutModalWindow();\n                });\n            }\n\n            /**\n             * This function update hidden markup for preview.\n             */\n            function updateHiddenMarkup() {\n                var element = null;\n                var entryid = \"\";\n                var kalturahost = \"\";\n                var partnerid = \"\";\n                var uiconfid = \"\";\n                var modalwidth = \"\";\n                var modalheight = \"\";\n                var playerstudio = \"\";\n\n                var date = new Date();\n                var datetime = date.getTime();\n\n                element = $(\"#entry_id\");\n                if (element !== null) {\n                    entryid = element.val();\n                }\n\n                element = $(\"#kalturahost\");\n                if (element !== null) {\n                    kalturahost = element.val();\n                }\n\n                element = $(\"#partner_id\");\n                if (element !== null) {\n                    partnerid = element.val();\n                }\n\n                element = $(\"#uiconfid\");\n                if (element !== null) {\n                    uiconfid = element.val();\n                }\n\n                element = $(\"#modalwidth\");\n                if (element !== null) {\n                    modalwidth = element.val();\n                }\n\n                element = $(\"#modalheight\");\n                if (element !== null) {\n                    modalheight = element.val();\n                }\n\n                element = $(\"#playerstudio\");\n                if (element !== null) {\n                    playerstudio = element.val();\n                }\n\n                element = $(\"#hidden_markup\");\n\n                window.console.dir(element);\n\n                if (element !== null && entryid !== \"\" && kalturahost !== \"\" && partnerid !== \"\" &&\n                    uiconfid !== \"\" && modalwidth !== \"\" && modalheight !== \"\" && playerstudio !== \"\") {\n                    if (playerstudio == \"ovp\") {\n                        var str1 = \"<iframe type=\\\"text/javascript\\\" src=\\\"\" + kalturahost + \"/p/\" + partnerid;\n                        str1 = str1 + \"/embedPlaykitJs/uiconfid/\" + uiconfid;\n                        str1 = str1 + \"?iframeembed=true&entry_id=\" + entryid + \"\\\" \";\n                        str1 = str1 + \"style=\\\"width: \" + modalwidth + \"px; height:\" + modalheight + \"px\\\" \";\n                        str1 = str1 + \"allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder=\\\"0\\\" \";\n                        str1 = str1 + \">\";\n                        str1 = str1 + \"</iframe>\";\n                        element.html(\"\");\n                        element.html(str1);\n                    } else {\n                        var str2 = \"<iframe src=\\\"\" + kalturahost + \"/p/\" + partnerid + \"/sp/\" + partnerid + \"00\";\n                        str2 = str2 + \"/embedIframeJs/uiconf_id/\" + uiconfid + \"/partnerid\" + partnerid;\n                        str2 = str2 + \"?iframeembed=true&playerId=kaltura_player_\" + datetime;\n                        str2 = str2 + \"&entry_id=\" + entryid + \"\\\" width=\\\"\" + modalwidth + \"\\\" height=\\\"\" + modalheight + \"\\\" \";\n                        str2 = str2 + \"allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder=\\\"0\\\"></iframe>\";\n                        element.html(\"\");\n                        element.html(str2);\n                    }\n                } else {\n                    window.alert(\"Not found.\");\n                }\n            }\n\n            // Entry a uload event callback.\n            $(window).on(\"unload\", function() {\n                // If window is resize, call modal window centerize function.\n                window.onresize = centeringModalSyncer;\n            });\n\n            $(\".media_thumbnail_cl\").on(\"click\", function() {\n                var element = $(\"#entry_id\");\n                var id = \"\";\n\n                if (element !== null) {\n                    id = element.val();\n                }\n                if (id !== null && id !== \"\") {\n                    createPreviewPanel();\n                }\n            });\n\n            $(\"#media_thumbnail\").on(\"load\", function() {\n                updateHiddenMarkup();\n            });\n        }\n    };\n\n});\n"],"names":["define","$","init","argWidth","argHeight","modalX","modalY","modalWidth","modalHeight","centeringModalSyncer","w","window","width","h","height","parseInt","css","cw","outerWidth","ch","outerHeight","left","top","createPreviewPanel","this","blur","dElm","document","documentElement","dBody","body","scrollLeft","scrollTop","append","fadeIn","fadeInModalWindow","element","str","html","on","scrollTo","fadeOut","remove","onresize","id","val","entryid","kalturahost","partnerid","uiconfid","modalwidth","modalheight","playerstudio","datetime","Date","getTime","console","dir","str1","str2","alert","updateHiddenMarkup"],"mappings":"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"}